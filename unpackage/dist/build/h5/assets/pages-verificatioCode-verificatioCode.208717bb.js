import{o as t,a as e,w as o,b as s,A as i,F as n,B as a,d as l,t as c,x as u,U as r,i as d,I as h,_ as m,n as p,C as f,E as y,J as g,g as b,H as w,l as S,j as _,e as C,p as V,v as x,Y as k}from"./index.2d1e5cbb.js";import{_ as v}from"./_plugin-vue_export-helper.cdc0426e.js";import{r as I}from"./uni-app.es.142f3165.js";const F=v({props:{latticeNum:{type:Number,default:4},latticeSize:{type:Number,default:100},borderStyle:{type:String,default:"border-bottom:1px solid gray;"},borderCheckStyle:{type:String,default:"border: 1px solid red !important;"},inputType:{type:String,default:"number"},blurShow:{type:Boolean,default:!1},ciphertextSty:{type:Number,default:0},updateOne:{type:Boolean,default:!0}},data:()=>({inputValues:"",blurShowLocal:!0}),mounted(){this.blurShowLocal=this.blurShow},methods:{latticeSty(t){let e=this.blurShowLocal&&(this.inputValues.length==t||this.inputValues.length==this.latticeNum&&t==this.latticeNum-1)?this.borderCheckStyle:this.borderStyle;return e+=`;width:${this.latticeSize}rpx;height:${this.latticeSize}rpx`,e},getValue(){return this.inputValues},inputVal(t){console.log(t),this.$emit("inputVerificationChange",this.inputValues)},setVerificationCode(t){t&&(this.inputValues=t)},cleanVal(){this.inputValues=""},latticeFoc(t){},blur(){!this.blurShow&&(this.blurShowLocal=!1)},focus(){!this.blurShow&&(this.blurShowLocal=!0)}}},[["render",function(m,p,f,y,g,b){const w=d,S=h;return t(),e(w,{class:"acqui_verification_code"},{default:o((()=>[s(w,{class:"verification_code_continor"},{default:o((()=>[(t(!0),i(n,null,a(f.latticeNum,((s,a)=>(t(),e(w,{key:a,class:"verification_code_item",onClick:t=>b.latticeFoc(a)},{default:o((()=>[g.inputValues[a]?(t(),i(n,{key:0},[1==f.ciphertextSty?(t(),e(w,{key:0,class:"point"})):(t(),i(n,{key:1},[l(c(2==f.ciphertextSty?"*":g.inputValues[a]),1)],64))],64)):u("",!0)])),_:2},1032,["onClick"])))),128))])),_:1}),r("div",{class:"input_info"},[s(S,{type:f.inputType,modelValue:g.inputValues,"onUpdate:modelValue":p[0]||(p[0]=t=>g.inputValues=t),focus:"",maxlength:f.latticeNum,onInput:b.inputVal,onBlur:b.blur,onFocus:b.focus},null,8,["type","modelValue","maxlength","onInput","onBlur","onFocus"])])])),_:1})}],["__scopeId","data-v-b63a78f9"]]),N={en:{"uni-countdown.day":"day","uni-countdown.h":"h","uni-countdown.m":"m","uni-countdown.s":"s"},"zh-Hans":{"uni-countdown.day":"天","uni-countdown.h":"时","uni-countdown.m":"分","uni-countdown.s":"秒"},"zh-Hant":{"uni-countdown.day":"天","uni-countdown.h":"時","uni-countdown.m":"分","uni-countdown.s":"秒"}},{t:L}=m(N);const D=v({name:"UniCountdown",emits:["timeup"],props:{showDay:{type:Boolean,default:!0},showColon:{type:Boolean,default:!0},start:{type:Boolean,default:!0},backgroundColor:{type:String,default:""},color:{type:String,default:"#333"},fontSize:{type:Number,default:14},splitorColor:{type:String,default:"#333"},day:{type:Number,default:0},hour:{type:Number,default:0},minute:{type:Number,default:0},second:{type:Number,default:0},timestamp:{type:Number,default:0}},data:()=>({timer:null,syncFlag:!1,d:"00",h:"00",i:"00",s:"00",leftTime:0,seconds:0}),computed:{dayText:()=>L("uni-countdown.day"),hourText:t=>L("uni-countdown.h"),minuteText:t=>L("uni-countdown.m"),secondText:t=>L("uni-countdown.s"),timeStyle(){const{color:t,backgroundColor:e,fontSize:o}=this;return{color:t,backgroundColor:e,fontSize:`${o}px`,width:22*o/14+"px",lineHeight:20*o/14+"px",borderRadius:3*o/14+"px"}},splitorStyle(){const{splitorColor:t,fontSize:e,backgroundColor:o}=this;return{color:t,fontSize:12*e/14+"px",margin:o?4*e/14+"px":""}}},watch:{day(t){this.changeFlag()},hour(t){this.changeFlag()},minute(t){this.changeFlag()},second(t){this.changeFlag()},start:{immediate:!0,handler(t,e){if(t)this.startData();else{if(!e)return;clearInterval(this.timer)}}}},created:function(t){this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.countDown()},unmounted(){clearInterval(this.timer)},methods:{toSeconds:(t,e,o,s,i)=>t?t-parseInt((new Date).getTime()/1e3,10):60*e*60*24+60*o*60+60*s+i,timeUp(){clearInterval(this.timer),this.$emit("timeup")},countDown(){let t=this.seconds,[e,o,s,i]=[0,0,0,0];t>0?(e=Math.floor(t/86400),o=Math.floor(t/3600)-24*e,s=Math.floor(t/60)-24*e*60-60*o,i=Math.floor(t)-24*e*60*60-60*o*60-60*s):this.timeUp(),e<10&&(e="0"+e),o<10&&(o="0"+o),s<10&&(s="0"+s),i<10&&(i="0"+i),this.d=e,this.h=o,this.i=s,this.s=i},startData(){if(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.seconds<=0)return this.seconds=this.toSeconds(0,0,0,0,0),void this.countDown();clearInterval(this.timer),this.countDown(),this.timer=setInterval((()=>{this.seconds--,this.seconds<0?this.timeUp():this.countDown()}),1e3)},update(){this.startData()},changeFlag(){this.syncFlag||(this.seconds=this.toSeconds(this.timestamp,this.day,this.hour,this.minute,this.second),this.startData(),this.syncFlag=!0)}}},[["render",function(i,n,a,r,h,m){const y=f,g=d;return t(),e(g,{class:"uni-countdown"},{default:o((()=>[a.showDay?(t(),e(y,{key:0,style:p([m.timeStyle]),class:"uni-countdown__number"},{default:o((()=>[l(c(h.d),1)])),_:1},8,["style"])):u("",!0),a.showDay?(t(),e(y,{key:1,style:p([m.splitorStyle]),class:"uni-countdown__splitor"},{default:o((()=>[l(c(m.dayText),1)])),_:1},8,["style"])):u("",!0),s(y,{style:p([m.timeStyle]),class:"uni-countdown__number"},{default:o((()=>[l(c(h.h),1)])),_:1},8,["style"]),s(y,{style:p([m.splitorStyle]),class:"uni-countdown__splitor"},{default:o((()=>[l(c(a.showColon?":":m.hourText),1)])),_:1},8,["style"]),s(y,{style:p([m.timeStyle]),class:"uni-countdown__number"},{default:o((()=>[l(c(h.i),1)])),_:1},8,["style"]),s(y,{style:p([m.splitorStyle]),class:"uni-countdown__splitor"},{default:o((()=>[l(c(a.showColon?":":m.minuteText),1)])),_:1},8,["style"]),s(y,{style:p([m.timeStyle]),class:"uni-countdown__number"},{default:o((()=>[l(c(h.s),1)])),_:1},8,["style"]),a.showColon?u("",!0):(t(),e(y,{key:2,style:p([m.splitorStyle]),class:"uni-countdown__splitor"},{default:o((()=>[l(c(m.secondText),1)])),_:1},8,["style"]))])),_:1})}],["__scopeId","data-v-c27d693f"]]),T=y.importObject("login",{customUI:!0});const U=v({data:()=>({smsCode:"",errorInfoValue:"",showKeyboard:!1,timeupSecond:60,mobile:"",requestVerifyCode:"",sureLogin:!1,isFinsh:!1,scanel:null}),onLoad(t){this.mobile=t.mobile||"",this.scanel=t.scanel||null},async mounted(){this.verifyCode()},watch:{smsCode:function(t,e){4===t.length&&t!==this.requestVerifyCode?(this.errorInfoValue="验证码错误",this.sureLogin=!1):(this.errorInfoValue="",this.sureLogin=!1),4===t.length&&t===this.requestVerifyCode&&(this.sureLogin=!0)}},methods:{timeup(){this.isFinsh=!0},getVal(){const t=this.$refs.verificationCodeStyle2.getValue();g({content:"获取到值："+t,showCancel:!1})},clearVal(){this.$refs.verificationCodeStyle2.cleanVal()},setVal(){this.$refs.verificationCodeStyle2.setVerificationCode("888")},inputVerificationChange(t){this.smsCode=t,console.log("值改变了："+t)},async resend(){if(this.isFinsh){const e=y.importObject("login");try{let t="wx"===this.scanel||"apple"===this.scanel?"bind":"login";const o=await e.sendSmsCode(this.mobile,t);console.log(this.scanel,"发送成功",t),0==o.code&&(this.mobile=o.mobile,this.verifyCode(),this.$refs.countDown.reset())}catch(t){console.log(t,"我是错误")}}},onFinsh(){this.isFinsh=!0},async verifyCode(){let t=y.importObject("login",{customUI:!0});const e=await t.getVerifySchema();try{this.requestVerifyCode=e.length>0?e[0].code:"0000"}catch(o){}},async smsLogin(){let t=this;try{if("wx"===t.scanel)return b({key:"weixinLoginInfo",success:async function(e){if(e.data){console.log(e.data,"我是你爸爸");let o={mobile:t.mobile};if(0==(await T.bindMobile(o)).code){let t=await T.getWeixinUserInfo(JSON.parse(e.data));if(0==t.code){let e={avatar:t.avatar,nickname:t.nickname};console.log(e,"param"),T.perfectInfo(e).then((t=>{t.success})).catch((t=>{}))}}}},fail:function(t){console.log(t,">>>>")}}),void w({url:"/pages/myMebers/myMebers"});if("apple"===t.scanel){try{let e={mobile:t.mobile};0==(await T.bindMobile(e)).code&&S({url:"/pages/personalnformation/personalnformation?mobile="+t.mobile})}catch(e){console.log(e,"我是苹果登录")}return}let o=y.importObject("login",{customUI:!0});const s=await o.getUserSchema(this.mobile);_("loginNum",s.affectedDocs+""),0==s.affectedDocs?(await this.smsCodeLoginValid("first"),S({url:"/pages/personalnformation/personalnformation?mobile="+this.mobile})):(await this.smsCodeLoginValid(),w({url:"/pages/myMebers/myMebers"}))}catch(o){console.log(o,"我是错误")}},async smsCodeLoginValid(t=null){let e={mobile:this.mobile,code:this.requestVerifyCode};const o=y.importObject("login",{customUI:!0}),s=await o.loginBySms(e);if(console.log(s,"发送成功"),0==s.code){if("first"===t)try{let t={avatar:"https://mp-4e6f1c48-a4dc-4897-a866-0a1a071023c3.cdn.bspapp.com/cloudstorage/65a7d49a-7fb3-4c1a-9bea-9d5e6b074fad.png"};console.log(t,"param"),o.perfectInfo(t).then((t=>{t.success})).catch((t=>{}))}catch(i){}try{_("userInfo",JSON.stringify(s.userInfo)),_("uni_id_token",s.token),_("uid",s.uid),_("tokenExpired",s.tokenExpired)}catch(i){}}},goBack(){w({url:"/pages/logining/logining"})}}},[["render",function(i,n,a,h,m,p){const y=V("van-icon"),g=I(x("verification-code-style2"),F),b=d,w=k,S=I(x("uni-countdown"),D),_=f;return t(),e(b,{class:"counter"},{default:o((()=>[s(y,{name:"arrow-left",size:"50upx",onClick:p.goBack,class:"app-esc"},null,8,["onClick"]),s(b,{class:"counter-matter"},{default:o((()=>[r("h1",{class:"code"},"请输入验证码"),r("span",{class:"phone"},"验证码已发送至 "+c(m.mobile),1),s(b,{class:"main"},{default:o((()=>[s(g,{latticeNum:4,ref:"verificationCodeStyle2",onInputVerificationChange:p.inputVerificationChange},null,8,["onInputVerificationChange"])])),_:1}),s(w,{class:C(["btn",m.sureLogin?"active":""]),onClick:p.smsLogin},{default:o((()=>[r("span",{class:"btn-text"},"登录")])),_:1},8,["class","onClick"]),s(b,{class:C(["time",m.isFinsh?"timeActive":""]),onClick:p.resend},{default:o((()=>[l(" 重新发送"),m.isFinsh?u("",!0):(t(),e(b,{key:0,class:"kuo_hao_style"},{default:o((()=>[l("( "),s(S,{"show-day":!1,color:m.isFinsh?"#1370ff":"#a8adb6",showColon:!0,hour:0,minute:0,second:m.timeupSecond,onTimeup:p.timeup},null,8,["color","second","onTimeup"]),s(_,null,{default:o((()=>[l("s")])),_:1}),l("） ")])),_:1}))])),_:1},8,["class","onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-a98a4b1d"]]);export{U as default};
