import{o as t,a as e,w as a,b as s,r as n,d as i,t as o,A as l,B as r,F as c,e as d,i as u,Y as h,U as f,E as m,a2 as p,H as D,l as y,m as g,x as b,p as k,v as w,f as v}from"./index.2d1e5cbb.js";import{_}from"./uni-popup.2df5a944.js";import{r as M}from"./uni-app.es.142f3165.js";import{h as L}from"./moment.9868ad4b.js";import{_ as Y}from"./_plugin-vue_export-helper.cdc0426e.js";import"./uni-transition.c98c413f.js";const T=Y({name:"calendar",props:{value:{required:!0,type:[Number,String,Date],default:()=>new Date},format:{type:[String],default:"YYYY年MM月DD日"},mode:{type:String,default:"single"},todayDisabled:{type:Boolean,default:!1}},data:()=>({dataList:[],weekList:["一","二","三","四","五","六","日"],touchStartX:0,touchStartY:0,transitionClass:""}),onShow(){this.transitionClass=""},methods:{render(){const t=L(new Date(this.value)).subtract(1,"months").daysInMonth(),e=L(new Date(this.value)).date(1).weekday();let a=e;1===e&&(a=6),0===e&&(a=7);const s=L(new Date(this.value)).daysInMonth(),n=[];for(let l=t;l>t-a+1;l--){const t=L(new Date(this.value)).subtract(1,"months").date(l).format("YYYY-MM-DD"),e=L(new Date(this.value)).subtract(1,"months").date(l).format("dddd");n.unshift({key:l,type:"prev",isSelected:!1,day:t,week:e})}for(let l=1;l<s+1;l++){const t=L(new Date(this.value)).date(l).format("YYYY-MM-DD"),e=L(new Date(this.value)).date(l).format("dddd");n.push({key:l,type:"current",isSelected:!1,day:t,week:e,disabled:!1})}const i=42-n.length;for(var o=1;o<i+1;o++){const t=L(new Date(this.value)).add(1,"months").date(o).format("YYYY-MM-DD"),e=L(new Date(this.value)).add(1,"months").date(o).format("dddd");n.push({key:o,type:"next",isSelected:!1,day:t,week:e})}if(this.todayDisabled&&n.forEach((t=>{"current"===t.type&&+new Date(t.day)<+new Date(L().format("YYYY-MM-DD"))&&(t.disabled=!0)})),this.formatDate(this.value)===this.formatDate(new Date)){const t=n.findIndex((t=>this.formatDate(new Date)===t.day));t>-1&&(n[t].isSelected=!0)}this.dataList=n},prevMonth(){const t=L(new Date(this.value)).subtract(1,"months").toDate();this.$emit("update:value",t)},nextMonth(){const t=L(new Date(this.value)).add(1,"months").toDate();this.$emit("update:value",t)},currentMonth(){this.$emit("update:value",new Date)},select(t){if("object"!==t.typeof){const e=this.dataList.findIndex((e=>e.day===this.formatDate(t)));return e>-1&&(this.dataList[e].isSelected=!0),!1}return t.forEach((t=>{const e=this.dataList.findIndex((e=>e.day===this.formatDate(t)));e>-1&&(this.dataList[e].isSelected=!0)})),!1},selectHandle(t){t.disabled||"current"===t.type&&("single"===this.mode&&this.dataList.forEach((t=>{t.isSelected=!1})),t.isSelected=!0),this.$emit("select",t)},getSelection(){return this.dataList.filter((t=>t.isSelected))},formatDate:(t,e="YYYY-MM-DD")=>L(new Date(t)).format(e),getCurrentData(){return this.dataList},touchStart(t){console.log("触摸开始"),this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY},touchEnd(t){console.log("触摸结束");let e=t.changedTouches[0].clientX-this.touchStartX,a=t.changedTouches[0].clientY-this.touchStartY;Math.abs(e)>50&&Math.abs(e)>Math.abs(a)?e>=0?(console.log("左滑"),this.leftMove()):(console.log("右滑"),this.rightMove()):Math.abs(a)>50&&Math.abs(e)<Math.abs(a)?a<0?console.log("上滑"):console.log("下滑"):console.log("可能是误触！")},rightMove(){this.transitionClass="left-start";const t=setTimeout((()=>{this.nextMonth(),this.transitionClass="left-end",clearTimeout(t)}),300)},leftMove(){this.transitionClass="right-start";const t=setTimeout((()=>{this.prevMonth(),this.transitionClass="right-end",clearTimeout(t)}),300)}},watch:{value:{immediate:!0,handler:function(){this.render()}}}},[["render",function(m,p,D,y,g,b){const k=u,w=h;return t(),e(k,{class:"calendar"},{default:a((()=>[s(k,{class:"calendar-operation"},{default:a((()=>[s(k,{class:"left"},{default:a((()=>[n(m.$slots,"operation-left",{item:D.value},(()=>[i(o(b.formatDate(D.value,"YYYY年MM月")),1)]),!0)])),_:3}),s(k,{class:"right"},{default:a((()=>[n(m.$slots,"operation-right",{item:D.value},(()=>[s(w,{class:"operation-right-btn",onClick:b.prevMonth},{default:a((()=>[i("上个月")])),_:1},8,["onClick"]),s(w,{class:"operation-right-btn",onClick:b.currentMonth},{default:a((()=>[i("今天")])),_:1},8,["onClick"]),s(w,{class:"operation-right-btn",onClick:b.nextMonth},{default:a((()=>[i("下个月")])),_:1},8,["onClick"])]),!0)])),_:3})])),_:3}),s(k,{class:"calendar-header"},{default:a((()=>[(t(!0),l(c,null,r(g.weekList,((s,i)=>(t(),e(k,{key:i},{default:a((()=>[n(m.$slots,"header",{},(()=>[f("span",{class:"calendar-header-title"},o(s),1)]),!0)])),_:2},1024)))),128))])),_:3}),s(k,{class:"transition"},{default:a((()=>[s(k,{class:d(["calendar-content",[g.transitionClass]]),onTouchstart:b.touchStart,onTouchend:b.touchEnd},{default:a((()=>[(t(!0),l(c,null,r(g.dataList,((l,r)=>(t(),e(k,{key:r,class:d([l.type]),onClick:t=>b.selectHandle(l)},{default:a((()=>[n(m.$slots,"default",{cell:l},(()=>[s(k,{class:d(["calendar-data-item",{"is-selected":l.isSelected}])},{default:a((()=>[i(o(l.key),1)])),_:2},1032,["class"])]),!0)])),_:2},1032,["class","onClick"])))),128))])),_:3},8,["class","onTouchstart","onTouchend"])])),_:3})])),_:3})}],["__scopeId","data-v-739f4772"]]),C=m.importObject("train");const S=Y({components:{calendar:T},data:()=>({trainListInfo:{},trainDate:null,memberName:"",value:new Date,showTipes:!0,isFixedTop:!1,actionList:[],actionBoxDate:"",isButton:!1,currentDay:null}),onLoad:function(t){t.traineeNo&&(this.traineeNo=t.traineeNo,this.memberName=t.memberName,this.getTrainList())},onPageScroll(t){t.scrollTop>p().statusBarHeight?this.isFixedTop=!0:this.isFixedTop=!1},onShow(){this.showTipes=!0;const t=setTimeout((()=>{this.showTipes=!1,clearTimeout(t)}),3e3)},methods:{async getTrainList(){const t=await C.getTrainList({traineeNo:this.traineeNo});if(t.data&&t.data.length>0){const e={};t.data.forEach((t=>{const a=JSON.parse(t.trainContent)||[];a.forEach((t=>{t.traineeTitle=t.traineeTitle.substring(0,5)})),e[t.trainDate]=a})),this.trainListInfo=e}},onClickLeft(){D({url:"/pages/myMebers/myMebers"})},onCloseHandle(){this.$refs.popup.close()},dataAndLabelHandle(t){if(console.log(t,"item"),!this.trainListInfo[t.day]&&t.disabled||"current"!==t.type)return;this.actionList=this.trainListInfo[t.day]||[],this.currentDay=t.day;let e=t.day.replace("-","年");e=e.replace("-","月"),e+="日",this.actionBoxDate=e,this.isButton=this.trainListInfo[t.day]&&this.trainListInfo[t.day].length<3||!this.trainListInfo[t.day],console.log("打开弹框",this.trainListInfo[t.day]),this.$refs.popup.open()},selectHandle(t){this.$refs.popup.close(),y({url:`/pages/newWorkout/newWorkout?traineeNo=${this.traineeNo}&trainDate=${t}&traineeName=${this.memberName}`})},traineeTitleHandle(t,e,a){this.$refs.popup.close(),"save"!==a.traineeStatus?y({url:`/pages/trainingRecordDetail/trainingRecordDetail?traineeNo=${this.traineeNo}&trainDate=${t}&traineeName=${this.memberName}&key=${e}`}):y({url:`/pages/newWorkout/newWorkout?traineeNo=${this.traineeNo}&trainDate=${t}&traineeName=${this.memberName}&key=${e}`})},addWorkout(){if(this.trainListInfo[this.getDay(new Date)]&&this.trainListInfo[this.getDay(new Date)].length>=3)return g({icon:"none",title:"每日最多添加三次训练记录",duration:2e3});y({url:`/pages/newWorkout/newWorkout?traineeNo=${this.traineeNo}&trainDate=${this.getDay(new Date)}&traineeName=${this.memberName}`})},getYearMonth(t){const e=new Date(t);var a;return e.getFullYear()+"."+((a=e.getMonth()+1)<10?"0"+a:a)},getDay(t){const e=t=>t<10?"0"+t:t,a=new Date(t);return a.getFullYear()+"-"+e(a.getMonth()+1)+"-"+e(a.getDate())}}},[["render",function(n,h,f,m,p,D){const y=u,g=k("van-nav-bar"),L=k("calendar"),Y=k("van-icon"),T=M(w("uni-popup"),_);return t(),e(y,{class:"training-record"},{default:a((()=>[s(y,{class:"background-header"}),s(y,{class:"background"}),s(y,{class:d(["status_bar",{isFixedTop:p.isFixedTop}])},null,8,["class"]),s(g,{class:d({isFixedTop:p.isFixedTop}),title:p.memberName,"left-text":"返回主页","left-arrow":"",onClickLeft:D.onClickLeft},null,8,["class","title","onClickLeft"]),s(y,{class:"calendar-box"},{default:a((()=>[s(L,{value:p.value,"onUpdate:value":h[0]||(h[0]=t=>p.value=t),ref:"calendar",todayDisabled:"",onSelect:D.dataAndLabelHandle},{"operation-left":a((()=>[s(y,{class:"calendar-title"},{default:a((()=>[i("训练记录")])),_:1})])),"operation-right":a((({item:t})=>[s(y,{class:"calendar-date"},{default:a((()=>[i(o(D.getYearMonth(t)),1)])),_:2},1024)])),default:a((({cell:n})=>[s(y,{class:"cell-box"},{default:a((()=>[s(y,{class:d(["cell-key",{active:n.isSelected}])},{default:a((()=>[i(o(n.key),1)])),_:2},1032,["class"]),p.trainListInfo[n.day]?(t(),e(y,{key:0,class:"cell-label-box"},{default:a((()=>[(t(!0),l(c,null,r(p.trainListInfo[n.day],((s,l)=>(t(),e(y,{class:"cell-label",key:l,onClick:v((t=>D.dataAndLabelHandle(n)),["stop"])},{default:a((()=>[i(o(s.traineeTitle),1)])),_:2},1032,["onClick"])))),128))])),_:2},1024)):b("",!0)])),_:2},1024)])),_:1},8,["value","onSelect"])])),_:1}),s(y,{class:"footer-button"},{default:a((()=>[p.showTipes?(t(),e(y,{key:0,class:"tipes"},{default:a((()=>[i(" 开始今日训练吧 ")])),_:1})):b("",!0),s(y,{class:"add-button",onClick:D.addWorkout},null,8,["onClick"])])),_:1}),s(T,{ref:"popup",type:"bottom","mask-background-color":"rgba(20, 21, 23, 0.6)"},{default:a((()=>[s(y,{class:"action-box"},{default:a((()=>[s(y,{class:"top"},{default:a((()=>[s(y,{class:"action-date"},{default:a((()=>[i(o(p.actionBoxDate),1)])),_:1}),s(y,{class:"box-close",onClick:D.onCloseHandle},{default:a((()=>[i("×")])),_:1},8,["onClick"])])),_:1}),s(y,{class:"content"},{default:a((()=>[(t(!0),l(c,null,r(p.actionList,((n,l)=>(t(),e(y,{class:"action-item",key:l,onClick:t=>D.traineeTitleHandle(p.currentDay,l,n)},{default:a((()=>[s(y,null,{default:a((()=>[i(o(n.traineeTitle),1)])),_:2},1024),s(Y,{name:"arrow"})])),_:2},1032,["onClick"])))),128))])),_:1}),p.isButton?(t(),e(y,{key:1,class:"action-button",onClick:h[1]||(h[1]=t=>D.selectHandle(p.currentDay))},{default:a((()=>[i("新建训练")])),_:1})):(t(),e(y,{key:0,class:"label"},{default:a((()=>[i("每日最多添加三次训练记录")])),_:1}))])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-58eaea61"]]);export{S as default};
