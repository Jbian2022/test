import{E as e,l as t,a5 as a,V as o,y as s,v as r,o as i,a as l,w as c,b as n,d as p,t as d,x as u,e as f,n as h,i as m,q as y,Y as _,C as g,a0 as v,s as C,m as A,H as k,a6 as w,A as I,B as x,F as M,p as b,U as P}from"./index.2d1e5cbb.js";import{_ as S}from"./uni-popup.2df5a944.js";import{r as O}from"./uni-app.es.142f3165.js";import{_ as B,a as R}from"./uni-list.782069dd.js";import{u as q}from"./js_sdk.265510cd.js";import{_ as D}from"./_plugin-vue_export-helper.cdc0426e.js";import{h as U}from"./moment.9868ad4b.js";import"./uni-transition.c98c413f.js";const F=e.importObject("uni-pay-co");const Y=D({name:"uni-pay",emits:["success","cancel","fail","create","mounted"],props:{adpid:{Type:String,default:""},toSuccessPage:{Type:Boolean,default:!0},returnUrl:{Type:String,default:""},mainColor:{Type:String,default:""},mode:{Type:String,default:""},logo:{Type:String,default:"/static/logo.png"},height:{Type:[String],default:"70vh"},debug:{Type:Boolean,default:!1}},data:()=>({options:{},res:{},images:{wxpay:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABC9JREFUeF7tWk1a20AMlUzv0bDr13AAYAOcpLCBcoqQU1DYEE6C2QAHIP26q3sPPOqniU2cZMYj+SeGxN5kEXlm9ObpjaQxwpY/uOX+Qw9Az4AtR6APgS0nQC+CfQi0FQLfrvcHXwAGPP4bQMK/fy5f7O9HehphwPfb/dOIogEhHQHBcamDCDESPoIxMQPTNSi1ABj+OrwDpNMaO5og4P2bMZOugFADwNTewWhU0/FVzAgnKZnxuoFQAbB3vX9MET7U2PHgq4R09vv8ZRI0bMhADMDw9uAhGN8NLQrWyAYRAGt1PgcRIU5TOms7JIIAdOL8nElJauikTRBKAdi7ObwioFFTzHaMw3mBzRV8DwKOXy+ertpagxcAq/YR/g2d6TlNrUDu4EiiE0Why4T1rgyINoXRC4DgjE+mF8+7RYAkp4RrRyVztRUKTgCkuz89fz4pAiB5z7WbklBrKxScAEgWxI6joZPXy5c4B0H0nkPdhzcHFIxxhHgZ8OA7AgMnAMObA479UnF6H5twQpF5RBMdibPDvB4AAAL6IZ0rNbTb9IngAyC8IwJ0K5okQBgzqFEKSV4wcXg17bxl8fIiJXFc0bHAgYLjYlHEFaZlVUQDoAIbcVZaN1VRrgAgUfImASiKW6Yh4pAohmHVQqpLABI0dMYiKhJPCeoV0ueuQsDmEJrkSeJ/bqNJnOqfApqVzWznzrdYWkvzhnUDYGnPKLTdV5gpfLiOqJUIaTefF8RKH6wxtAOX2IdA8NcCmmRItmBLfVF5jRBnR58kGQtWlGUJlBeAxpQ5A4eFKTu/ufLzPQv1f2mRRDiZ/nyyYwYrypI0OlQOc/9PsgshDsh2v+BUwTFnD3K5DglVlD4WlDZEsqywNgiK2F9gQBkLi7EtyV59WhBsiTURCjy5QZMgYRn9cxbZWgCQ+IKlnH2sFQYTURHmCYMgAJaKs9aYPkXNXGK6QhQdt9xeC4UhTC+eV/wVASASmrKj6IMA4NIBMQDsX1VN4IlbuU0K7vmiQS0G5EOpmiW6I1Dpjtp8pYc5yxYVj0RtXcMJcwDFSiqYLh2x+QgqAJwnAuEEydxbkZtdj+fKPVfwbPIq7KngqvMVX4WoAmDBAcH9HTMmXw23s0LJSlPOOsZx0l8VAu/0Fzjuc2Td3aY5zf1VoZgBvPgmvuhoIrFSMSXQThcDoJo0YLxGLfBSv5IINgVC1XxCOb/oZrkTBtRJqkQgKG6ROgPgPbGq/6HVIiYK51WngAj5ikbBhoZi3FALbHmozhlQXFChTc75g6wRM2ufzb9N/IwMcG0wg8HZJf9HBF/tFZnBBBH+cW/BpBDnd4XLDNJcon4oBiiY7jS194mEI0IaSz+12ygAclSYEcXvFsqA3UgANEzqAdCgtYm2PQM2cVc1PvUM0KC1ibY9AzZxVzU+bT0D/gPs/oxfcUEcJAAAAABJRU5ErkJggg==",alipay:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA2FJREFUeF7tmU122jAQx2cMB2hp9yULeK+naHISwhJyiIRDBJaQkwRO0fdgEWff0h4ANH0yFc+m+hhbckKNvJUsaX76z4ckhAv/8MLthwggKuDCCUQXuHABxCAYXSC6wIUTiC7wFgL4MPveTaj9optrO+696ya8yeQRQFRAdIEYAxoVBD/PNtdCwHWpDIJwr+1PMCk1DgAkCSx/jHrLsv/p+lfKAp3HzQOYDAqxKtcYBJPtXe/B1Y3TXgmATGst0WIrgAC7JmBINOQsNN8HE0zfVQFlFxzrgFgHNLQOkNJuQ7vrcgkS1CXEua5fgnDj+l+172CX/h59Tbn9Of0qBUE1cGe2ngPhLWeiEH0krFDBT63HC8Cnx/VtFuFDfgl90UOldDvuX4WcSo7lBSD0YuR4H6ebZwRNkRUw9xdSah1G+IzZmW5IW7ERDX/e9Rc+YwerBEMvQo1nrhfqkf/ZuYCxxK5J/t4AjkFQBi71CXxFoFSWq2XTlkn+AndXodNf5SwgT4J7gnttoNL6BqUEmCZET/tkvzQZYj5g1Sf/0goIkfcJYIkEK5HsFnkYnen6BXQptUb5lwJgMz4zCihXD/BqAwVDuoy+Uqx399kACrkZaYECVjY5qxJZXpoQwrcDHB6UghfVvPssAMo35W4R7oZVg5EMmAJxUCZ2CNzfVJ2Pm6qdleDBNwFClaHZdRrQAEhWe25VSPCuAMo1tnQhdIzMNUixfDYBqAOGVQEKQB15OFMCwXPV3QsFww7g73E39Pudr/Gn0EyplQPXCkBF/5AKsBtPKRA+AdKAEx/0BhYLL9nHFkhZLiBvbkOcxFzG5wPtoe7gBUrrTiMttqO+8ebZCkAtWErs17jHvrrSLcj+lkCpKeV5g/ABIA05lqgVM4Er2nPhZgev7DHGnToLG+ALIC9budgWwoRzyuMUPlzj8waVBuELIFOB5iksi7xIKQh8PS4wu8/j+a3vBScbRAgABVfg5BZbH6SFgP0kVIl7UCjNja4RCkAGwecaPLDhp4yNsSYkADlp/mncdNLLu8fpud9XQK7//wERGoBrAefSfgRBsLI9pTtPg+diUNV1yLuJypVg1Un/p/8arwDXZkQALkJNb48KaPoOu+yLCnARanp7VEDTd9hlX1SAi1DT2/8AaakVXysj5qkAAAAASUVORK5CYII="},originalRroviders:["wxpay","alipay"],currentProviders:["wxpay","alipay"]}),async mounted(){let e=await this.getPayProviderFromCloud();0===e.errCode&&(this.originalRroviders=e.provider,this.currentProviders=JSON.parse(JSON.stringify(this.originalRroviders))),this.$emit("mounted",{images:this.images,originalRroviders:this.originalRroviders,currentProviders:this.currentProviders})},methods:{async open(e={}){if(e.provider){let t=[];this.originalRroviders.map(((a,o)=>{e.provider.indexOf(a)>-1&&t.push(a)})),this.currentProviders=t,delete e.provider}else this.currentProviders=JSON.parse(JSON.stringify(this.originalRroviders));this.options=e,1===this.currentProviders.length?this.createOrder({provider:this.currentProviders[0]}):("pc"===this.modeCom&&await this._pcChooseProvider(this.currentProviders[0]),this.$refs.payPopup.open())},async createOrder(e={}){let{options:t}=this;if(Object.assign(t,e),"appleiap"===t.provider)return this._appleiapCreateOrder(t);"pc"===q.checkPlatform()&&(t.qr_code=!0);let a={provider:t.provider,total_fee:t.total_fee,openid:undefined,order_no:t.order_no||this.res.order_no,out_trade_no:t.out_trade_no||this.res.out_trade_no,description:t.description,type:t.type,qr_code:t.qr_code,custom:t.custom,other:t.other};t.openid&&"wxpay"===t.provider&&(a.openid=t.openid);let o=await F.createOrder(a);if(0===o.errCode)if(this.$emit("create",o),this.res=o,o.qr_code)t.cancel_popup||("pc"===this.modeCom?(this.$refs.payPopup.open(),this._pcChooseProvider(t.provider)):this.$refs.qrcodePopup.open());else if(o.order)if("jsapi"===o.provider_pay_type)WeixinJSBridge.invoke("getBrandWCPayRequest",o.order,(e=>{"get_brand_wcpay_request:ok"==e.err_msg?this._getOrder():"get_brand_wcpay_request:cancel"==e.err_msg?this.$emit("cancel",e):"get_brand_wcpay_request:fail"==e.err_msg&&(console.error("getBrandWCPayRequest-fail: ",e),this.$emit("fail",e))}));else{let e=o.order.codeUrl,t=o.order.mwebUrl||o.order.mweb_url;setTimeout((()=>{this.$refs.payConfirmPopup.open(),window.location.href=e||t}),200)}},async getOrder(e={}){try{let t=await F.getOrder(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async refund(e={}){try{let t=await F.refund(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async getRefund(e={}){try{let t=await F.getRefund(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async closeOrder(e={}){try{let t=await F.closeOrder(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async getPayProviderFromCloud(e={}){try{let t=await F.getPayProviderFromCloud(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async getProviderAppId(e={}){try{let t=await F.getProviderAppId(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async getOpenid(e={}){try{let t=await F.getOpenid(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async verifyReceiptFromAppleiap(e={}){try{let t=await F.verifyReceiptFromAppleiap(e);return"function"==typeof e.success&&e.success(t),t}catch(t){"function"==typeof e.fail&&e.fail(t)}},async getCode(){},paySuccess(e={}){this.$refs.payPopup.close(),this.$refs.payConfirmPopup.close(),this.clearQrcode(),this.toSuccessPage&&this.pageToSuccess(e),this.$emit("success",e)},pageToSuccess(e){if("pc"!==this.modeCom)t({url:`/uni_modules/uni-pay/pages/success/success?out_trade_no=${e.out_trade_no}&order_no=${e.pay_order.order_no}&pay_date=${e.pay_order.pay_date}&total_fee=${e.pay_order.total_fee}&adpid=${this.adpid}&return_url=${this.returnUrl}&main_color=${this.mainColor}`});else if(this.returnUrl){let a=this.returnUrl+`?out_trade_no=${e.out_trade_no}&order_no=${e.pay_order.order_no}`;0!==a.indexOf("/")&&(a=`/${a}`),t({url:a})}},clearQrcode(){this.res.codeUrl="",this.res.qr_code_image=""},async _getOrder(){this.getOrder({out_trade_no:this.res.out_trade_no,await_notify:!0,success:e=>{e.has_paid&&(this.$refs.qrcodePopup.close(),this.paySuccess(e))}})},clearQrcodePopup(){this.$refs.qrcodePopup.close()},_afreshPayment(){this.createOrder()},clearPayConfirmPopup(){this.$refs.payConfirmPopup.close()},_pcChooseProvider(e){if(e!==this.options.provider)return this.createOrder({provider:e})},async _appleiapCreateOrder(e){let t=new appleiapSdk.Iap({products:[e.productid]});a({title:"加载中..."}),await t.init();let s=(await t.getProduct())[0];e.total_fee=100*s.price,e.description=s.description;let r={provider:e.provider,total_fee:e.total_fee,order_no:e.order_no||this.res.order_no,out_trade_no:e.out_trade_no||this.res.out_trade_no,description:e.description,type:e.type,custom:e.custom},i=await F.createOrder(r);if(0===i.errCode){this.$emit("create",i),this.res=i,a({title:"支付请求中..."});try{this.debug&&console.log("正在请求苹果服务器",e.productid,i.out_trade_no);let s=await t.requestPayment({productid:e.productid,username:i.out_trade_no});this.debug&&console.log("用户支付成功",s),a({title:"正在处理支付结果..."});let r=await this.verifyReceiptFromAppleiap({out_trade_no:s.payment.username,transaction_receipt:s.transactionReceipt,transaction_identifier:s.transactionIdentifier});0===r.errCode&&(await t.finishTransaction(s),o(),this.paySuccess(r))}catch(l){2===(l.errCode||l.code)?(this.debug&&console.log("用户取消支付"),this.$emit("cancel",l)):(console.error("appleiapCreateOrder:fail",l),this.$emit("fail",l)),o()}}},async appleiapRestore(){a({title:"检测支付环境..."});let e=new appleiapSdk.Iap;await e.init();try{this.debug&&console.log("正在查询是否有漏单信息");const t=await e.restoreCompletedTransactions({username:""});if(this.debug&&console.log("漏单查询结果："+(0===t.length?"未漏单":"有漏单"),t),!t.length)return;for(let a=0;a<t.length;a++){let o=t[a];switch(transaction.transactionState){case appleiapSdk.IapTransactionState.purchased:0===(await this.verifyReceiptFromAppleiap({out_trade_no:o.payment.username,transaction_receipt:o.transactionReceipt,transaction_identifier:o.transactionIdentifier})).errCode&&await e.finishTransaction(o);break;case appleiapSdk.IapTransactionState.failed:await e.finishTransaction(o)}}}catch(t){console.error(t)}finally{o()}}},watch:{},computed:{modeCom(){if(this.mode)return this.mode;let e=s();return e&&"pc"===e.deviceType?"pc":"mobile"}}},[["render",function(e,t,a,o,s,v){const C=m,A=y,k=_,w=g,I=O(r("uni-popup"),S),x=O(r("uni-list-item"),B),M=O(r("uni-list"),R);return i(),l(C,{class:"uni-pay"},{default:c((()=>["pc"===v.modeCom?(i(),l(I,{key:0,ref:"payPopup",type:"center","safe-area":!1},{default:c((()=>[n(C,{class:"pc-pay-popup"},{default:c((()=>[n(C,{class:"pc-pay-popup-title"},{default:c((()=>[p("收银台")])),_:1}),n(C,{class:"pc-pay-popup-flex"},{default:c((()=>[n(C,{class:"pc-pay-popup-qrcode-box"},{default:c((()=>[n(A,{class:"pc-pay-popup-qrcode-image",src:s.res.qr_code_image},null,8,["src"]),n(C,{class:"pc-pay-popup-amount-box"},{default:c((()=>[n(C,{class:"pc-pay-popup-amount-tips"},{default:c((()=>[p("扫一扫付款")])),_:1}),n(C,{class:"pc-pay-popup-amount"},{default:c((()=>[p(d((s.options.total_fee/100).toFixed(2)),1)])),_:1})])),_:1}),s.res.qr_code_image?(i(),l(C,{key:0,class:"pc-pay-popup-complete-button"},{default:c((()=>[n(k,{type:"primary",onClick:t[0]||(t[0]=e=>v._getOrder())},{default:c((()=>[p("我已完成支付")])),_:1})])),_:1})):u("",!0)])),_:1}),n(C,{class:"pc-pay-popup-provider-list"},{default:c((()=>[s.currentProviders.indexOf("wxpay")>-1?(i(),l(C,{key:0,class:f(["pc-pay-popup-provider-item","wxpay"==s.options.provider?"active":""]),onClick:t[1]||(t[1]=e=>v._pcChooseProvider("wxpay"))},{default:c((()=>[n(A,{src:s.images.wxpay,class:"pc-pay-popup-provider-image"},null,8,["src"]),n(w,{class:"pc-pay-popup-provider-text"},{default:c((()=>[p("微信支付")])),_:1})])),_:1},8,["class"])):u("",!0),s.currentProviders.indexOf("alipay")>-1?(i(),l(C,{key:1,class:f(["pc-pay-popup-provider-item","alipay"==s.options.provider?"active":""]),onClick:t[2]||(t[2]=e=>v._pcChooseProvider("alipay"))},{default:c((()=>[n(A,{src:s.images.alipay,class:"pc-pay-popup-provider-image"},null,8,["src"]),n(w,{class:"pc-pay-popup-provider-text"},{default:c((()=>[p("支付宝支付")])),_:1})])),_:1},8,["class"])):u("",!0),n(C,{class:"pc-pay-popup-logo"},{default:c((()=>[n(A,{src:a.logo,mode:"widthFix"},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},512)):(i(),l(I,{key:1,ref:"payPopup",type:"bottom","safe-area":!1},{default:c((()=>[n(C,{class:"mobile-pay-popup",style:h("min-height: "+a.height+";")},{default:c((()=>[n(C,{class:"mobile-pay-popup-title"},{default:c((()=>[p("收银台")])),_:1}),n(C,{class:"mobile-pay-popup-amount-box"},{default:c((()=>[n(C,null,{default:c((()=>[p("待支付金额：")])),_:1}),n(C,{class:"mobile-pay-popup-amount"},{default:c((()=>[p(d((s.options.total_fee/100).toFixed(2)),1)])),_:1})])),_:1}),n(C,{class:"mobile-pay-popup-provider-list"},{default:c((()=>[n(M,null,{default:c((()=>[s.currentProviders.indexOf("wxpay")>-1?(i(),l(x,{key:0,thumb:s.images.wxpay,title:"微信支付",onClick:t[3]||(t[3]=e=>v.createOrder({provider:"wxpay"})),clickable:"",link:""},null,8,["thumb"])):u("",!0),s.currentProviders.indexOf("alipay")>-1?(i(),l(x,{key:1,thumb:s.images.alipay,title:"支付宝",onClick:t[4]||(t[4]=e=>v.createOrder({provider:"alipay"})),clickable:"",link:""},null,8,["thumb"])):u("",!0)])),_:1})])),_:1})])),_:1},8,["style"])])),_:1},512)),n(I,{ref:"qrcodePopup",type:"center","safe-area":!1,animation:!1,"mask-click":!1,onClose:v.clearQrcode},{default:c((()=>[n(C,{class:"qrcode-popup-content"},{default:c((()=>[n(A,{src:s.res.qr_code_image,class:"qrcode-image"},null,8,["src"]),n(C,{class:"qrcode-popup-info"},{default:c((()=>[n(C,null,{default:c((()=>[n(w,{class:"qrcode-popup-info-fee"},{default:c((()=>[p(d((s.options.total_fee/100).toFixed(2)),1)])),_:1}),n(w,null,{default:c((()=>[p("元")])),_:1})])),_:1}),"wxpay"==s.options.provider?(i(),l(C,{key:0},{default:c((()=>[p("请用微信扫码支付")])),_:1})):"alipay"==s.options.provider?(i(),l(C,{key:1},{default:c((()=>[p("请用支付宝扫码支付")])),_:1})):u("",!0)])),_:1}),n(k,{type:"primary",onClick:t[5]||(t[5]=e=>v._getOrder())},{default:c((()=>[p("我已完成支付")])),_:1}),n(C,{class:"qrcode-popup-cancel",onClick:v.clearQrcodePopup},{default:c((()=>[p("暂不支付")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["onClose"]),n(I,{ref:"payConfirmPopup",type:"center","safe-area":!1,animation:!1,"mask-click":!1},{default:c((()=>[n(C,{class:"pay-confirm-popup-content"},{default:c((()=>[n(C,{class:"pay-confirm-popup-title"},{default:c((()=>[p("请确认支付是否已完成")])),_:1}),n(C,null,{default:c((()=>[n(k,{type:"primary",onClick:t[6]||(t[6]=e=>v._getOrder())},{default:c((()=>[p("已完成支付")])),_:1})])),_:1}),n(C,{class:"pay-confirm-popup-refresh"},{default:c((()=>[n(k,{type:"default",onClick:t[7]||(t[7]=e=>v._afreshPayment())},{default:c((()=>[p("支付遇到问题，重新支付")])),_:1})])),_:1}),n(C,{class:"pay-confirm-popup-cancel",onClick:v.clearPayConfirmPopup},{default:c((()=>[p("暂不支付")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-973bea99"]]),E=e.importObject("my",{customUI:!0}),Q=e.importObject("login",{customUI:!0});const T=D({data:()=>({total_fee:1,description:"测试订单",type:"test",openid:"",custom:{a:"a",b:1},adpid:"1000000001",transaction_id:"",getOrderRes:{},userInfo:{nickname:"",avatar:null,comment:null,vipLevel:null,vipEndDate:null,referrer:null},payShow:!1,columns:[{text:"001",value:"001"},{text:"002",value:"002"},{text:"003",value:"003"},{text:"004",value:"004"},{text:"005",value:"005"},{text:"006",value:"006"},{text:"007",value:"007"},{text:"008",value:"008"},{text:"009",value:"009"},{text:"010",value:"010"}],cardList:[{hotMsg:"每天仅需0.26元",text:"年卡限时特惠",money:"98",des:"365",unit:"元/年",activity:"无限会员数",active:!0,order_no:"20221027812838484891"+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1),out_trade_no:"200123321321312"+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1),productid:"jianbiannianka",vipLevel:"annualCard"},{hotMsg:"立省90元",text:"三个月",money:"68",des:"158",unit:"元/季度",activity:"限100个会员",active:!1,order_no:"20221027812838483891"+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1),out_trade_no:"200123321321323"+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1),productid:"jianbianjika",vipLevel:"quarterCard"},{hotMsg:"立省40元",text:"月卡",money:"38",des:"78",unit:"元/月",activity:"限30个会员",active:!1,order_no:"20221027812838486891"+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1),out_trade_no:"200123321321323"+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1),productid:"jianbianyueka",vipLevel:"monthlyCard"}],hotInfo:{text1:"267",text2:"365元/年"},payInfo:{},show:!1,termOfValidity:!1,platform:s().platform}),onShow(){this.getUserInfo()},mounted(){let e=U("2021-05-07").isSame("2021-05-08");console.log(e,"???")},watch:{payShow:{handler:function(e){e?v():C()}},cardList:{handler:function(e){let t=JSON.parse(JSON.stringify(e)).find((e=>e.active));this.payInfo=t},deep:!0,immediate:!0}},methods:{onCreate(e){console.log("create: ",e)},successChangeBusiness(){let e=this;e.getUserInfo();let t=null;switch(e.payInfo.vipLevel){case"annualCard":t=U().add(1,"years").add(1,"day").format("YYYY-MM-DD");break;case"quarterCard":t=U().add(3,"months").add(1,"day").format("YYYY-MM-DD");break;case"monthlyCard":t=U().add(1,"months").add(1,"day").format("YYYY-MM-DD")}let a={vipEndDate:t,vipLevel:e.payInfo.vipLevel};console.log(a,"param"),Q.perfectInfo(a).then((e=>{e.success})).catch((e=>{}))},onSuccess(e){console.log("success: ",e),e.user_order_success,this.successChangeBusiness(),self.payShow=!1},createOrder(e){let t={};t="appleiap"===e?{provider:e,order_no:String(this.payInfo.order_no),out_trade_no:String(this.payInfo.out_trade_no),type:"appleiap",productid:this.payInfo.productid,custom:{}}:{provider:e,total_fee:100*this.payInfo.money,type:"recharge",order_no:String(this.payInfo.order_no),out_trade_no:String(this.payInfo.out_trade_no),description:"教练充值VIP",qr_code:"",openid:"",custom:""},console.log(t,"我是支付的参数"),this.$refs.uniPay.createOrder(t)},payClick(){"ios"===this.platform?this.createOrder("appleiap"):this.payShow=!0},pickerSelect(e){this.columns.forEach((e=>e.active=!1)),e.active=!0},async getUserInfo(){const e=await E.getUserInfo(),{avatar:t,nickname:a,comment:o,vipLevel:s,vipEndDate:r,referrer:i}=e.data;if(this.userInfo={avatar:t||null,nickname:a||null,comment:o||null,vipLevel:s||null,vipEndDate:r||null,referrer:i||null},this.userInfo.vipLevel){let e=U().format("YYYY-MM-DD"),t=U(e).isSame(this.userInfo.vipEndDate);this.termOfValidity=!t&&U(e).isBefore(this.userInfo.vipEndDate)}else this.termOfValidity=!1;console.log(e,88888)},async setReferrer(){await E.updateUserInfo({referrer:this.userInfo.referrer}),A({title:"设置成功",duration:2e3})},selectCard(e){this.cardList.forEach((e=>e.active=!1)),e.active=!0,this.hotInfo.text1=+e.des-+e.money,this.hotInfo.text2=e.des+e.unit},openCard(){k({url:"/pages/openCard/openCard"})},setUp(){t({url:"/pages/setUp/setUp"})},personalInfo(){k({url:"/pages/personalInfo/personalInfo"})},copyText(e){w({data:e,success:function(){console.log("success"),A({title:"复制成功",duration:2e3})}})},openSheet(){if(this.userInfo.referrer)return!1;this.$refs.popup.open()},openSheet1(){this.$refs.popup1.open()},popupChange(e){if(e.show)v();else{const e=setTimeout((()=>{C(),clearTimeout(e)}),100)}},onConfirm(){if(this.columns.every((e=>!e.active)))return;const e=this.columns.find((e=>e.active));this.userInfo.referrer=e.text,this.$refs.popup.close(),this.setReferrer()},onCancel(){this.$refs.popup.close()}}},[["render",function(e,t,a,o,s,u){const h=m,_=b("van-image"),v=g,C=b("van-cell"),A=b("van-button"),k=y,w=b("van-action-sheet"),B=O(r("uni-popup"),S),R=O(r("uni-pay"),Y);return i(),l(h,{class:"my"},{default:c((()=>[n(h,{class:"background"}),n(h,{class:"status_bar"}),!s.termOfValidity||"annualCard"!=s.userInfo.vipLevel&&"quarterCard"!=s.userInfo.vipLevel&&"monthlyCard"!=s.userInfo.vipLevel?(i(),l(h,{key:1,class:"vip-card default"},{default:c((()=>[n(h,{class:"left"},{default:c((()=>[n(h,{class:"card-info",onClick:u.personalInfo},{default:c((()=>[n(h,{class:"user-logo"},{default:c((()=>[n(_,{round:"",src:s.userInfo.avatar},null,8,["src"])])),_:1}),n(h,{class:"card-name"},{default:c((()=>[p(d(s.userInfo.nickname),1)])),_:1}),n(h,{class:"card-status"},{default:c((()=>[p("普卡教练")])),_:1})])),_:1},8,["onClick"]),n(h,{class:"card-des"},{default:c((()=>[p(d(s.userInfo.vipEndDate?"已到期: "+s.userInfo.vipEndDate+", 续费畅享多项特权~":"开通金卡教练，畅享多项特权~"),1)])),_:1})])),_:1}),n(h)])),_:1})):(i(),l(h,{key:0,class:"vip-card"},{default:c((()=>[n(h,{class:"left"},{default:c((()=>[n(h,{class:"card-info",onClick:u.personalInfo},{default:c((()=>[n(h,{class:"user-logo"},{default:c((()=>[n(_,{round:"",src:s.userInfo.avatar},null,8,["src"])])),_:1}),n(h,{class:"card-name"},{default:c((()=>[p(d(s.userInfo.nickname),1)])),_:1}),n(h,{class:"card-status"},{default:c((()=>[p("金卡教练")])),_:1})])),_:1},8,["onClick"]),n(h,{class:"card-des"},{default:c((()=>[p(d(s.userInfo.vipEndDate?"到期时间: "+s.userInfo.vipEndDate:"立即续费金卡教练，畅享多项特权~"),1)])),_:1})])),_:1}),n(h)])),_:1})),n(h,{class:"vip-title"},{default:c((()=>[p("金卡教练")])),_:1}),n(h,{class:"card-types-box"},{default:c((()=>[n(h,{class:"card-types"},{default:c((()=>[(i(!0),I(M,null,x(s.cardList,((e,t)=>(i(),l(h,{key:t,class:"type-item-box"},{default:c((()=>[n(h,{class:f(["type-item",{active:e.active}]),onClick:t=>u.selectCard(e)},{default:c((()=>[n(h,{class:"hot-msg"},{default:c((()=>[p(d(e.hotMsg),1)])),_:2},1024),n(h,{class:"text"},{default:c((()=>[p(d(e.text),1)])),_:2},1024),n(h,{class:"money"},{default:c((()=>[p("¥"),n(v,{class:"num"},{default:c((()=>[p(d(e.money),1)])),_:2},1024)])),_:2},1024),n(h,{class:"des"},{default:c((()=>[p(d(e.des)+d(e.unit),1)])),_:2},1024),P("div",{class:"activity"},d(e.activity),1)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),n(h,{class:"vip-title"},{default:c((()=>[p("金卡教练权益")])),_:1}),n(h,{class:"equity-box"},{default:c((()=>[n(h,{class:"equity-list"},{default:c((()=>[n(h,{class:"equity-item"},{default:c((()=>[n(h,{class:"logo"}),n(h,{class:"des"},{default:c((()=>[p("体态评估")])),_:1})])),_:1}),n(h,{class:"equity-item"},{default:c((()=>[n(h,{class:"logo"}),n(h,{class:"des"},{default:c((()=>[p("体能评估")])),_:1})])),_:1}),n(h,{class:"equity-item"},{default:c((()=>[n(h,{class:"logo"}),n(h,{class:"des"},{default:c((()=>[p("动态评估")])),_:1})])),_:1}),n(h,{class:"equity-item"},{default:c((()=>[n(h,{class:"logo"}),n(h,{class:"des"},{default:c((()=>[p("训练计划")])),_:1})])),_:1}),n(h,{class:"equity-item"},{default:c((()=>[n(h,{class:"logo"}),n(h,{class:"des"},{default:c((()=>[p("问题动作库")])),_:1})])),_:1}),n(h,{class:"equity-item"},{default:c((()=>[n(h,{class:"logo"}),n(h,{class:"des"},{default:c((()=>[p("全部动作库")])),_:1})])),_:1})])),_:1})])),_:1}),n(h,{class:"contact-customer-box"},{default:c((()=>[n(h,{class:"contact-customer"},{default:c((()=>[n(h,{class:"title"},{default:c((()=>[p("联系客服")])),_:1}),n(h,{class:"customer-info"},{default:c((()=>[n(h,{class:"customer-item",onClick:t[0]||(t[0]=e=>u.copyText("FeiYun41"))},{default:c((()=>[n(v,null,{default:c((()=>[p("客服微信：FeiYun41")])),_:1}),n(v,null,{default:c((()=>[p("复制")])),_:1})])),_:1}),n(h,{class:"customer-item",onClick:t[1]||(t[1]=e=>u.copyText("Kingtran12@aliyun.com"))},{default:c((()=>[n(v,null,{default:c((()=>[p("客服邮箱：Kingtran12@aliyun.com")])),_:1}),n(v,null,{default:c((()=>[p("复制")])),_:1})])),_:1})])),_:1})])),_:1}),n(h,{class:"recommend-box"},{default:c((()=>[n(h,{class:"recommend"},{default:c((()=>[n(C,{title:"推荐人","is-link":!s.userInfo.referrer,value:s.userInfo.referrer,onClick:u.openSheet},{icon:c((()=>[n(h,{class:"icon"})])),_:1},8,["is-link","value","onClick"])])),_:1}),n(h,{class:"recommend"},{default:c((()=>[n(C,{title:"设置","is-link":"",onClick:u.setUp},{icon:c((()=>[n(h,{class:"icon air-config"})])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),n(h,{class:"footer-button"},{default:c((()=>[n(h,{class:"text-box"},{default:c((()=>[n(h,{class:"yuan"},{default:c((()=>[p("已省￥"+d(s.hotInfo.text1),1)])),_:1}),n(h,{class:"des"},{default:c((()=>[p(d(s.hotInfo.text2),1)])),_:1})])),_:1}),n(A,{block:"",onClick:u.payClick},{default:c((()=>[p("确认开通并支付￥"+d(s.payInfo.money)+"元",1)])),_:1},8,["onClick"]),n(w,{class:"payment-action-sheet",show:s.payShow,"onUpdate:show":t[4]||(t[4]=e=>s.payShow=e)},{default:c((()=>[n(h,{class:"title",onClick:e.aliPayment},{default:c((()=>[p("选择支付方式")])),_:1},8,["onClick"]),n(h,{class:"actions"},{default:c((()=>[n(h,{class:"action"},{default:c((()=>[n(k,{class:"img",src:"/assets/zfb.f689e6f3.svg",onClick:t[2]||(t[2]=e=>u.createOrder("alipay"))}),n(h,{class:"text"},{default:c((()=>[p("支付宝")])),_:1})])),_:1}),n(h,{class:"action"},{default:c((()=>[n(k,{class:"img",src:"/assets/saveWechat.e193995d.svg",onClick:t[3]||(t[3]=e=>u.createOrder("wxpay"))}),n(h,{class:"text"},{default:c((()=>[p("微信")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1}),n(B,{ref:"popup",type:"bottom",class:"recommend-sheet",onChange:u.popupChange},{default:c((()=>[n(h,{class:"picker-box"},{default:c((()=>[n(h,{class:"picker-header"},{default:c((()=>[n(h,{class:"cancel-btn",onClick:u.onCancel},{default:c((()=>[p("取消")])),_:1},8,["onClick"]),n(h,{class:"title"},{default:c((()=>[p("推荐人")])),_:1}),n(h,{class:"success-btn",onClick:u.onConfirm},{default:c((()=>[p("确认")])),_:1},8,["onClick"])])),_:1}),n(h,{class:"message"},{default:c((()=>[n(h,{class:"text"},{default:c((()=>[p("请注意：推荐人选择之后不可更改")])),_:1})])),_:1}),n(h,{class:"picker-content"},{default:c((()=>[(i(!0),I(M,null,x(s.columns,((e,t)=>(i(),l(h,{class:f(["picker-item",{active:e.active}]),key:t,onClick:t=>u.pickerSelect(e)},{default:c((()=>[p(d(e.text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["onChange"]),n(B,{ref:"popup1",type:"bottom",class:"recommend-sheet",onChange:u.popupChange},{default:c((()=>[n(h,{class:"payment-action-sheet"},{default:c((()=>[n(h,{class:"title"},{default:c((()=>[p("选择支付方式")])),_:1}),n(h,{class:"actions"},{default:c((()=>[n(h,{class:"action"},{default:c((()=>[n(_,{class:"img",src:"https://mp-4e6f1c48-a4dc-4897-a866-0a1a071023c3.cdn.bspapp.com/cloudstorage/92897c24-96a3-4bb2-8fb8-44019822af77.svg"}),n(h,{class:"text"},{default:c((()=>[p("支付宝")])),_:1})])),_:1}),n(h,{class:"action"},{default:c((()=>[n(_,{class:"img",src:"https://mp-4e6f1c48-a4dc-4897-a866-0a1a071023c3.cdn.bspapp.com/cloudstorage/ca311552-a492-4e14-b884-cefd7a6cb712.svg"}),n(h,{class:"text"},{default:c((()=>[p("微信")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onChange"]),n(R,{ref:"uniPay",adpid:s.adpid,height:"70vh","return-url":"/pages/order-detail/order-detail",logo:"/static/logo.png",onSuccess:u.onSuccess,onCreate:u.onCreate},null,8,["adpid","onSuccess","onCreate"])])),_:1})}],["__scopeId","data-v-bfcfcb2f"]]);export{T as default};
